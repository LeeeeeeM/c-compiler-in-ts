# CPC Compiler - Browser Edition

一个基于浏览器的C语言编译器，仿照 `cpc.c` 实现，支持词法分析、语法分析、代码生成和虚拟机执行。

## 功能特性

### 🚀 核心功能
- **词法分析器**: 支持C语言关键字、标识符、数字、字符串、运算符
- **语法分析器**: 支持函数定义、变量声明、表达式、控制流语句
- **代码生成器**: 生成虚拟机指令
- **虚拟机**: 执行生成的指令，支持系统调用

### 📝 支持的C语言特性

#### 数据类型
- `int` - 64位整数
- `char` - 8位字符
- `void` - 函数返回类型

#### 控制流
- `if/else` 条件语句
- `while` 循环
- `return` 返回语句
- 函数调用

#### 运算符
- 算术运算符: `+`, `-`, `*`, `/`, `%`
- 比较运算符: `==`, `!=`, `<`, `>`, `<=`, `>=`
- 赋值运算符: `=`
- 位运算符: `&`, `|`, `^`, `<<`, `>>`

#### 数字格式
- 十进制: `123`
- 十六进制: `0x1A`, `0XFF`
- 八进制: `077`

#### 系统函数
- `printf()` - 格式化输出（简化版）

### 🎯 示例程序

项目包含多个示例程序，展示编译器的各种功能：

1. **Hello World** - 基本的printf输出
2. **Simple Math** - 变量声明和算术运算
3. **Factorial** - 递归函数调用
4. **Fibonacci** - 递归和循环
5. **Conditional** - if/else条件语句
6. **Loop** - while循环

### 🛠️ 调试功能

- **实时编译**: 输入代码后立即编译
- **虚拟机状态**: 查看寄存器、栈状态
- **指令查看**: 显示生成的虚拟机指令
- **错误报告**: 详细的编译和运行时错误信息

## 技术架构

### 编译器前端
- **词法分析器** (`lib/lexer/`): 将源代码转换为token流
- **语法分析器** (`lib/parser/`): 构建抽象语法树(AST)
- **代码生成器** (`lib/codegen/`): 将AST转换为虚拟机指令

### 虚拟机
- **指令集**: 支持39种指令，包括算术、逻辑、跳转、系统调用
- **内存管理**: 栈式虚拟机，支持函数调用和局部变量
- **系统调用**: 简化的printf实现

### 前端界面
- **React + TypeScript**: 现代化的用户界面
- **Monaco Editor**: 代码编辑器（可选）
- **Tailwind CSS**: 响应式设计
- **实时反馈**: 编译结果和执行输出

## 项目结构

```
cpc-ts/
├── lib/                    # 编译器核心
│   ├── lexer/             # 词法分析器
│   ├── parser/            # 语法分析器
│   ├── codegen/           # 代码生成器
│   ├── vm/                # 虚拟机
│   ├── types/             # 类型定义
│   └── index.ts           # 主编译器类
├── src/                   # 前端应用
│   ├── App.tsx            # 主应用组件
│   └── main.tsx           # 应用入口
└── cpc.c                  # 原始C编译器参考
```

## 使用方法

1. **安装依赖**:
   ```bash
   npm install
   ```

2. **启动开发服务器**:
   ```bash
   npm run dev
   ```

3. **在浏览器中打开**: http://localhost:5173

4. **编写C代码**: 在左侧编辑器中输入C代码

5. **运行**: 点击"Run"按钮编译和执行代码

6. **调试**: 点击调试按钮查看虚拟机状态和指令

## 开发说明

### 扩展功能

要添加新的C语言特性，需要修改以下文件：

1. **词法分析器** (`lib/lexer/index.ts`): 添加新的token类型
2. **类型定义** (`lib/types/index.ts`): 定义新的AST节点类型
3. **语法分析器** (`lib/parser/index.ts`): 添加新的语法规则
4. **代码生成器** (`lib/codegen/index.ts`): 生成对应的虚拟机指令
5. **虚拟机** (`lib/vm/index.ts`): 实现新的指令执行逻辑

### 虚拟机指令

虚拟机支持以下指令类别：

- **加载/存储**: IMM, LEA, PUSH, LI, LC, SI, SC
- **算术运算**: ADD, SUB, MUL, DIV, MOD
- **逻辑运算**: AND, OR, XOR, SHL, SHR
- **比较运算**: EQ, NE, LT, LE, GT, GE
- **跳转指令**: JMP, JZ, JNZ
- **函数调用**: CALL, NVAR, DARG, RET
- **系统调用**: OPEN, READ, CLOS, PRTF, MALC, FREE, MSET, MCMP, EXIT

## 参考

本项目基于 `cpc.c` 实现，这是一个用C语言编写的自包含编译器，展示了编译器的基本工作原理。

## 许可证

MIT License